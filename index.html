<!DOCTYPE html>
<html lang="en" id="main-html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Content Security Policy for enhanced security -->
    <meta http-equiv="Content-Security-Policy" 
          content="default-src 'self'; 
                   script-src 'self' https://cdn.jsdelivr.net; 
                   style-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com;
                   img-src 'self' https://cdn-icons-png.flaticon.com data:;
                   connect-src 'self';
                   font-src 'self' https://cdn.jsdelivr.net;
                   frame-src https://docs.google.com;">
    
    <title>Old Paper Upload System</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3135/3135715.png">
    
    <!-- Bootstrap with SRI (Subresource Integrity) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
          rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
          crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" 
          rel="stylesheet"
          integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" 
          crossorigin="anonymous">
    
    <style>
        :root {
            --primary-color: #76520e;
            --primary-light: #e9dcc1;
            --secondary-color: #f8f6e4;
            --card-bg: #fffcf2;
            --text-dark: #333;
            --text-light: #666;
            --shadow-light: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-medium: 0 6px 20px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            background: linear-gradient(135deg, #f8f6e4 0%, #f0ecda 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-dark);
            min-height: 100vh;
        }
        
        .navbar {
            background: var(--primary-light);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 1rem 0;
        }
        
        .hero {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 3rem 2rem;
            margin: 2rem 0 3rem;
            box-shadow: var(--shadow-light);
            border: 1px solid rgba(118, 82, 14, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: linear-gradient(45deg, transparent 50%, rgba(118, 82, 14, 0.05) 50%);
            border-radius: 0 1rem 0 0;
        }
        
        .hero h1 {
            color: var(--primary-color);
            font-weight: 700;
            margin-bottom: 1.5rem;
            font-size: 2.5rem;
        }
        
        .hero p.lead {
            color: var(--text-light);
            font-size: 1.2rem;
            margin-bottom: 1rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .section-header {
            color: var(--primary-color);
            font-weight: 700;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid rgba(118, 82, 14, 0.2);
            position: relative;
        }
        
        .section-header::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 60px;
            height: 3px;
            background: var(--primary-color);
        }
        
        .card {
            background: white;
            border: none;
            border-radius: 1rem;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-light) 0%, #e5d9b6 100%);
            border-bottom: 2px solid rgba(118, 82, 14, 0.1);
            padding: 1.25rem 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .footer {
            background: var(--primary-light);
            text-align: center;
            padding: 2rem 0;
            margin-top: 4rem;
            border-top: 2px solid rgba(118, 82, 14, 0.1);
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .lang-switcher {
            text-align: right;
            margin-bottom: 20px;
        }
        
        .lang-btn {
            margin-left: 5px;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            background: white;
            padding: 0.375rem 1rem;
            font-weight: 500;
            border-radius: 50px;
            transition: var(--transition);
        }
        
        .lang-btn:hover, .lang-btn.active {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }
        
        .form-select {
            border: 2px solid #ddd;
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            background-color: white;
            font-size: 1rem;
            transition: var(--transition);
            height: 52px;
        }
        
        .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(118, 82, 14, 0.25);
        }
        
        .form-select:not(:disabled) {
            cursor: pointer;
            background: white url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%2376520e' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e") no-repeat right 0.75rem center/16px 12px;
        }
        
        .form-select:disabled {
            background-color: #f9f9f9;
            border-color: #eee;
            color: #999;
            opacity: 0.7;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
            display: block;
        }
        
        .btn-outline-secondary {
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 0.75rem 2rem;
            font-weight: 500;
            border-radius: 50px;
            transition: var(--transition);
        }
        
        .btn-outline-secondary:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            border: none;
            padding: 0.875rem 2rem;
            font-weight: 600;
            border-radius: 50px;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .paper-list-view {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .upload-section {
            margin-top: 4rem;
            padding-top: 3rem;
            border-top: 2px solid rgba(118, 82, 14, 0.1);
        }
        
        .no-papers {
            padding: 4rem 1rem;
            text-align: center;
            color: #888;
            background: #fafafa;
            border-radius: 0 0 1rem 1rem;
        }
        
        .no-papers i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 1.5rem;
        }
        
        .paper-item {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .paper-item:hover {
            background: rgba(118, 82, 14, 0.03);
        }
        
        .paper-item:last-child {
            border-bottom: none;
        }
        
        .paper-icon {
            width: 48px;
            height: 48px;
            background: rgba(118, 82, 14, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .paper-info {
            flex: 1;
        }
        
        .paper-title {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
            font-size: 1.1rem;
        }
        
        .paper-meta {
            color: var(--text-light);
            font-size: 0.9rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .paper-meta span {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .back-btn {
            color: var(--primary-color);
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border: 2px solid var(--primary-color);
            background: transparent;
            border-radius: 50px;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .back-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }
        
        .selection-flow {
            margin-bottom: 3rem;
            padding: 1.5rem;
            background: white;
            border-radius: 1rem;
            box-shadow: var(--shadow-light);
        }
        
        .step {
            text-align: center;
            position: relative;
            flex: 1;
        }
        
        .step-indicator {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f0f0f0;
            color: #999;
            font-weight: bold;
            margin-bottom: 0.75rem;
            position: relative;
            z-index: 2;
            transition: var(--transition);
        }
        
        .step.active .step-indicator {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 0 0 5px rgba(118, 82, 14, 0.1);
        }
        
        .step.completed .step-indicator {
            background: var(--primary-color);
            color: white;
        }
        
        .step.completed .step-indicator::after {
            content: '✓';
            font-size: 1.2rem;
        }
        
        .step-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
        
        .step.active .step-label {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .privacy-notice {
            background: linear-gradient(135deg, rgba(118, 82, 14, 0.05) 0%, rgba(118, 82, 14, 0.02) 100%);
            border-left: 4px solid var(--primary-color);
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 0 0.75rem 0.75rem 0;
        }
        
        .privacy-icon {
            color: var(--primary-color);
            margin-right: 15px;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            background: var(--primary-color);
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 10px rgba(118, 82, 14, 0.2);
        }
        
        .upload-features {
            margin: 2rem 0;
            padding: 2rem;
            background: white;
            border-radius: 1rem;
            border: 2px dashed rgba(118, 82, 14, 0.2);
        }
        
        .feature-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(118, 82, 14, 0.03);
            border-radius: 0.75rem;
            transition: var(--transition);
        }
        
        .feature-item:hover {
            background: rgba(118, 82, 14, 0.05);
            transform: translateX(5px);
        }
        
        .feature-item:last-child {
            margin-bottom: 0;
        }
        
        .feature-icon {
            color: var(--primary-color);
            margin-right: 15px;
            font-size: 1.5rem;
            min-width: 30px;
            margin-top: 0.25rem;
        }
        
        .feature-content h6 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .feature-content p {
            color: var(--text-light);
            font-size: 0.95rem;
            margin-bottom: 0;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .hero {
                padding: 2rem 1rem;
                margin: 1rem 0 2rem;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .hero p.lead {
                font-size: 1.1rem;
            }
            
            .paper-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .paper-meta {
                flex-direction: column;
                gap: 0.25rem;
            }
            
            .selection-flow {
                display: none;
            }
            
            .privacy-notice {
                padding: 1.25rem;
            }
            
            .upload-features {
                padding: 1.5rem;
            }
            
            .form-select {
                height: 48px;
                font-size: 0.95rem;
            }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(118, 82, 14, 0.3);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(118, 82, 14, 0.5);
        }
        
        /* Selection dropdowns container */
        .dropdowns-container {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: var(--shadow-light);
            margin-bottom: 2rem;
        }
        
        /* Loading animation */
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(118, 82, 14, 0.1);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="#" style="font-weight:bold;color:#76520e">
                <div class="logo-container">
                    <div class="logo-icon">
                        <i class="bi bi-file-earmark-text"></i>
                    </div>
                    <span class="lang-text" data-en="Old Paper Upload System" data-zh="舊試卷上傳系統">Old Paper Upload System</span>
                </div>
            </a>
            <div class="lang-switcher d-lg-none ms-auto">
                <button class="btn btn-sm lang-btn active" onclick="changeLang('en')" id="lang-btn-en">EN</button>
                <button class="btn btn-sm lang-btn" onclick="changeLang('zh')" id="lang-btn-zh">繁中</button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <!-- Language Switcher (Desktop) -->
        <div class="lang-switcher d-none d-lg-block">
            <button class="btn btn-sm lang-btn active" onclick="changeLang('en')" id="lang-btn-en-lg">English</button>
            <button class="btn btn-sm lang-btn" onclick="changeLang('zh')" id="lang-btn-zh-lg">繁體中文</button>
        </div>
        
        <!-- Hero Section -->
        <div class="hero">
            <h1 class="lang-text" data-en="Welcome to the Old Paper Upload System" data-zh="歡迎來到舊試卷上傳系統">
                Welcome to the Old Paper Upload System
            </h1>
            <p class="lead lang-text" data-en="Find old examination papers from junior high to senior high: Chinese, English, Math, Physics, Chemistry, and Biology." data-zh="查找初中至高中的舊試卷：中文、英文、數學、物理、化學、生物。">
                Find old examination papers from junior high to senior high: Chinese, English, Math, Physics, Chemistry, and Biology.
            </p>
            <p class="lang-text" data-en="Browse by grade, subject, term and year. Contribute by uploading your own papers (Google Form, admin-reviewed)." data-zh="可按年級、科目、學期及年份瀏覽，亦可透過 Google 表單上傳您的試卷（需經管理員審核後顯示）。">
                Browse by grade, subject, term and year. Contribute by uploading your own papers (Google Form, admin-reviewed).
            </p>
            <a href="#upload" class="btn btn-outline-secondary btn-lg mt-3 lang-text" data-en="Upload Your Paper" data-zh="上傳您的試卷">
                Upload Your Paper
            </a>
        </div>

        <!-- Selection Flow Indicator (Desktop only) -->
        <div class="selection-flow d-none d-lg-block">
            <div class="row">
                <div class="col-3">
                    <div class="step active" id="step-grade-indicator">
                        <div class="step-indicator">1</div>
                        <div class="step-label lang-text" data-en="Select Grade" data-zh="選擇年級">Select Grade</div>
                    </div>
                </div>
                <div class="col-3">
                    <div class="step" id="step-subject-indicator">
                        <div class="step-indicator">2</div>
                        <div class="step-label lang-text" data-en="Select Subject" data-zh="選擇科目">Select Subject</div>
                    </div>
                </div>
                <div class="col-3">
                    <div class="step" id="step-term-indicator">
                        <div class="step-indicator">3</div>
                        <div class="step-label lang-text" data-en="Select Term" data-zh="選擇學期">Select Term</div>
                    </div>
                </div>
                <div class="col-3">
                    <div class="step" id="step-year-indicator">
                        <div class="step-indicator">4</div>
                        <div class="step-label lang-text" data-en="Select Year" data-zh="選擇年份">Select Year</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Browse Old Papers Section -->
        <h2 class="section-header lang-text" data-en="Browse Old Papers" data-zh="瀏覽舊試卷">Browse Old Papers</h2>
        
        <!-- Selection Dropdowns Container -->
        <div class="dropdowns-container">
            <div class="row g-4">
                <!-- Grade Dropdown -->
                <div class="col-lg-3 col-md-6">
                    <label class="form-label lang-text" data-en="Grade" data-zh="年級">Grade</label>
                    <select class="form-select" id="gradeDropdown" onchange="selectGrade(this.value)">
                        <option value="" selected class="lang-text" data-en="Select Grade" data-zh="請選擇年級">Select Grade</option>
                        <option value="jh1" class="lang-text" data-en="First Year Junior High" data-zh="初中一年級">First Year Junior High</option>
                        <option value="jh2" class="lang-text" data-en="Second Year Junior High" data-zh="初中二年級">Second Year Junior High</option>
                        <option value="jh3" class="lang-text" data-en="Third Year Junior High" data-zh="初中三年級">Third Year Junior High</option>
                        <option value="sh1" class="lang-text" data-en="First Year Senior High" data-zh="高中一年級">First Year Senior High</option>
                        <option value="sh2" class="lang-text" data-en="Second Year Senior High" data-zh="高中二年級">Second Year Senior High</option>
                        <option value="sh3" class="lang-text" data-en="Third Year Senior High" data-zh="高中三年級">Third Year Senior High</option>
                        <option value="other" class="lang-text" data-en="Other/Advanced" data-zh="其他/進階學段">Other/Advanced</option>
                    </select>
                </div>

                <!-- Subject Dropdown -->
                <div class="col-lg-3 col-md-6">
                    <label class="form-label lang-text" data-en="Subject" data-zh="科目">Subject</label>
                    <select class="form-select" id="subjectDropdown" disabled onchange="selectSubject(this.value)">
                        <option value="" selected class="lang-text" data-en="Select Subject" data-zh="請選擇科目">Select Subject</option>
                        <option value="chi" class="lang-text" data-en="Chinese" data-zh="中文">Chinese</option>
                        <option value="eng" class="lang-text" data-en="English" data-zh="英文">English</option>
                        <option value="math" class="lang-text" data-en="Mathematics" data-zh="數學">Mathematics</option>
                        <option value="phy" class="lang-text" data-en="Physics" data-zh="物理">Physics</option>
                        <option value="chem" class="lang-text" data-en="Chemistry" data-zh="化學">Chemistry</option>
                        <option value="bio" class="lang-text" data-en="Biology" data-zh="生物">Biology</option>
                    </select>
                </div>

                <!-- Term Dropdown -->
                <div class="col-lg-3 col-md-6">
                    <label class="form-label lang-text" data-en="Term" data-zh="學期">Term</label>
                    <select class="form-select" id="termDropdown" disabled onchange="selectTerm(this.value)">
                        <option value="" selected class="lang-text" data-en="Select Term" data-zh="請選擇學期">Select Term</option>
                        <option value="t1" class="lang-text" data-en="First Term" data-zh="第一學期">First Term</option>
                        <option value="t2" class="lang-text" data-en="Second Term" data-zh="第二學期">Second Term</option>
                        <option value="t3" class="lang-text" data-en="Third Term" data-zh="第三學期">Third Term</option>
                    </select>
                </div>

                <!-- Year Dropdown -->
                <div class="col-lg-3 col-md-6">
                    <label class="form-label lang-text" data-en="Year" data-zh="年份">Year</label>
                    <select class="form-select" id="yearDropdown" disabled onchange="selectYear(this.value)">
                        <option value="" selected class="lang-text" data-en="Select Year" data-zh="請選擇年份">Select Year</option>
                        <option value="2020">2020</option>
                        <option value="2021">2021</option>
                        <option value="2022">2022</option>
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="loading-spinner">
            <div class="spinner"></div>
            <p class="lang-text" data-en="Loading papers..." data-zh="正在加載試卷...">Loading papers...</p>
        </div>

        <!-- Paper List (Initially Hidden) -->
        <div id="paper-list" class="paper-list-view" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0" id="paper-list-header"></h5>
                </div>
                <div class="card-body p-0">
                    <div id="paper-list-body">
                        <!-- Papers will be dynamically loaded here -->
                    </div>
                </div>
            </div>
            <div class="text-center mt-4">
                <button class="btn back-btn" onclick="resetBrowser()">
                    <i class="bi bi-arrow-left me-1"></i>
                    <span class="lang-text" data-en="Back to Selection" data-zh="返回選擇">Back to Selection</span>
                </button>
            </div>
        </div>

        <!-- Upload Section -->
        <section class="upload-section" id="upload">
            <h2 class="section-header lang-text" data-en="Upload Your Old Paper" data-zh="上傳您的舊試卷">Upload Your Old Paper</h2>
            
            <!-- Privacy Notice -->
            <div class="privacy-notice">
                <div class="d-flex">
                    <i class="bi bi-shield-check privacy-icon"></i>
                    <div>
                        <h5 class="lang-text" data-en="Privacy Protection Guarantee" data-zh="隱私保護承諾">Privacy Protection Guarantee</h5>
                        <p class="mb-0 lang-text" data-en="All uploaded papers will be treated with strict confidentiality. We will redact personal information (names, student IDs, etc.) to protect uploaders' identities. All papers undergo administrator review before publication to ensure compliance with privacy policies." data-zh="所有上傳的試卷將嚴格保密處理。我們會對個人信息（姓名、學號等）進行打碼處理，以保護上傳者身份。所有試卷在發布前都會經過管理員審核，確保符合隱私政策。">
                            All uploaded papers will be treated with strict confidentiality. We will redact personal information (names, student IDs, etc.) to protect uploaders' identities. All papers undergo administrator review before publication to ensure compliance with privacy policies.
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <p class="lang-text" data-en="Anyone can upload their own old exam paper using Google Form. Uploaded content will be reviewed by the administrator before being added to the public system." data-zh="任何人都可以使用 Google 表單上傳自己的舊考卷。所有上傳內容由管理員審核後才會顯示在本系統。">
                        Anyone can upload their own old exam paper using Google Form. Uploaded content will be reviewed by the administrator before being added to the public system.
                    </p>
                    
                    <!-- Upload Features -->
                    <div class="upload-features">
                        <div class="feature-item">
                            <i class="bi bi-shield-check feature-icon"></i>
                            <div class="feature-content">
                                <h6 class="lang-text" data-en="Confidential Processing" data-zh="保密處理">Confidential Processing</h6>
                                <p class="lang-text" data-en="All personal information will be redacted to protect your privacy." data-zh="所有個人信息將被遮蓋，保護您的隱私。">
                                    All personal information will be redacted to protect your privacy.
                                </p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <i class="bi bi-cloud-upload feature-icon"></i>
                            <div class="feature-content">
                                <h6 class="lang-text" data-en="Upload" data-zh="上傳">Upload</h6>
                                <p class="lang-text" data-en="Uploader information is not displayed publicly. Only administrators can see uploader details." data-zh="上傳者信息不會公開顯示，僅管理員可見。">
                                    Uploader information is not displayed publicly. Only administrators can see uploader details.
                                </p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <i class="bi bi-clipboard-check feature-icon"></i>
                            <div class="feature-content">
                                <h6 class="lang-text" data-en="Administrator Review" data-zh="管理員審核">Administrator Review</h6>
                                <p class="lang-text" data-en="All papers are reviewed to ensure quality and privacy compliance before publishing." data-zh="所有試卷都會經過審核，確保質量和隱私合規後才會發布。">
                                    All papers are reviewed to ensure quality and privacy compliance before publishing.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <a href="https://forms.gle/zDivK2A37ZDgNQDj8" target="_blank" rel="noopener noreferrer" class="btn btn-success">
                            <i class="bi bi-cloud-upload me-2"></i>
                            <span class="lang-text" data-en="Upload via Google Form" data-zh="透過 Google 表單上傳">Upload via Google Form</span>
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="container">
            <span class="lang-text" data-en="Old Paper Upload System" data-zh="舊試卷上傳系統">
                Old Paper Upload System
            </span>
        </div>
    </div>

    <!-- Bootstrap JS with SRI -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" 
            crossorigin="anonymous"></script>
    
    <script>
        // Current selection state
        let currentGrade = null, currentSubject = null, currentTerm = null, currentYear = null;
        let currentLang = 'en';

        // Security: HTML escaping function
        function escapeHtml(text) {
            if (typeof text !== 'string') return '';
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Security: Validate input against allowed values
        function validateInput(value, allowedValues) {
            return allowedValues.includes(value);
        }

        // Language switching function
        function changeLang(lang) {
            currentLang = lang;
            
            // Update html lang attribute
            document.getElementById('main-html').setAttribute('lang', lang === 'zh' ? 'zh-Hant' : 'en');
            
            // Update all elements with lang-text class safely
            document.querySelectorAll('.lang-text').forEach(element => {
                const text = element.getAttribute(`data-${lang}`);
                if (text) {
                    element.textContent = text;
                }
            });
            
            // Update active language buttons
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll(`#lang-btn-${lang}, #lang-btn-${lang}-lg`).forEach(btn => {
                if (btn) btn.classList.add('active');
            });
            
            // Update paper list header if showing
            if (currentGrade && currentSubject && currentTerm && currentYear) {
                updatePaperListHeader();
            }
        }

        // Update step indicators
        function updateStepIndicators() {
            const steps = [
                { id: 'grade-indicator', condition: currentGrade },
                { id: 'subject-indicator', condition: currentSubject },
                { id: 'term-indicator', condition: currentTerm },
                { id: 'year-indicator', condition: currentYear }
            ];
            
            steps.forEach((step, index) => {
                const stepElement = document.getElementById(`step-${step.id}`);
                if (!stepElement) return;
                
                // Reset all steps
                stepElement.classList.remove('active', 'completed');
                
                // Mark completed steps
                if (step.condition) {
                    stepElement.classList.add('completed');
                }
                
                // Mark active step (first non-completed step)
                if (!step.condition && steps.slice(0, index).every(s => s.condition)) {
                    stepElement.classList.add('active');
                }
            });
            
            // If all steps are completed, mark year as active
            if (currentGrade && currentSubject && currentTerm && currentYear) {
                document.getElementById('step-year-indicator').classList.add('active');
            }
        }

        // Show loading spinner
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'block';
        }

        // Hide loading spinner
        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
        }

        // Grade selection with validation
        function selectGrade(val) {
            const allowedGrades = ['jh1', 'jh2', 'jh3', 'sh1', 'sh2', 'sh3', 'other'];
            if (!validateInput(val, allowedGrades)) {
                console.error('Invalid grade selected');
                return;
            }
            
            currentGrade = val;
            // Enable subject dropdown
            document.getElementById('subjectDropdown').disabled = false;
            document.getElementById('subjectDropdown').selectedIndex = 0;
            
            // Reset later selections
            currentSubject = null;
            currentTerm = null;
            currentYear = null;
            document.getElementById('termDropdown').selectedIndex = 0;
            document.getElementById('termDropdown').disabled = true;
            document.getElementById('yearDropdown').selectedIndex = 0;
            document.getElementById('yearDropdown').disabled = true;
            
            // Hide paper list if showing
            document.getElementById('paper-list').style.display = 'none';
            
            // Update steps
            updateStepIndicators();
        }

        // Subject selection with validation
        function selectSubject(val) {
            const allowedSubjects = ['chi', 'eng', 'math', 'phy', 'chem', 'bio'];
            if (!validateInput(val, allowedSubjects)) {
                console.error('Invalid subject selected');
                return;
            }
            
            currentSubject = val;
            // Enable term dropdown
            document.getElementById('termDropdown').disabled = false;
            document.getElementById('termDropdown').selectedIndex = 0;
            
            // Reset later selections
            currentTerm = null;
            currentYear = null;
            document.getElementById('yearDropdown').selectedIndex = 0;
            document.getElementById('yearDropdown').disabled = true;
            
            // Hide paper list if showing
            document.getElementById('paper-list').style.display = 'none';
            
            // Update steps
            updateStepIndicators();
        }

        // Term selection with validation
        function selectTerm(val) {
            const allowedTerms = ['t1', 't2', 't3'];
            if (!validateInput(val, allowedTerms)) {
                console.error('Invalid term selected');
                return;
            }
            
            currentTerm = val;
            // Enable year dropdown
            document.getElementById('yearDropdown').disabled = false;
            document.getElementById('yearDropdown').selectedIndex = 0;
            
            // Reset year selection
            currentYear = null;
            
            // Hide paper list if showing
            document.getElementById('paper-list').style.display = 'none';
            
            // Update steps
            updateStepIndicators();
        }

        // Year selection with validation
        function selectYear(val) {
            const allowedYears = ['2020', '2021', '2022', '2023', '2024', '2025', '2026'];
            if (!validateInput(val, allowedYears)) {
                console.error('Invalid year selected');
                return;
            }
            
            currentYear = val;
            showPaperList();
            updateStepIndicators();
        }

        // Show paper list with selected criteria
        async function showPaperList() {
            showLoading();
            updatePaperListHeader();
            
            // Simulate loading delay
            await new Promise(resolve => setTimeout(resolve, 800));
            
            loadPapers();
            document.getElementById('paper-list').style.display = 'block';
            hideLoading();
            
            // Scroll to paper list
            document.getElementById('paper-list').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        // Update paper list header (safe version)
        function updatePaperListHeader() {
            const gradeNames = {
                jh1: { en: "First Year Junior High", zh: "初中一年級" },
                jh2: { en: "Second Year Junior High", zh: "初中二年級" },
                jh3: { en: "Third Year Junior High", zh: "初中三年級" },
                sh1: { en: "First Year Senior High", zh: "高中一年級" },
                sh2: { en: "Second Year Senior High", zh: "高中二年級" },
                sh3: { en: "Third Year Senior High", zh: "高中三年級" },
                other: { en: "Other/Advanced", zh: "其他/進階學段" }
            };
            
            const subjectNames = {
                chi: { en: "Chinese", zh: "中文" },
                eng: { en: "English", zh: "英文" },
                math: { en: "Mathematics", zh: "數學" },
                phy: { en: "Physics", zh: "物理" },
                chem: { en: "Chemistry", zh: "化學" },
                bio: { en: "Biology", zh: "生物" }
            };
            
            const termNames = {
                t1: { en: "First Term", zh: "第一學期" },
                t2: { en: "Second Term", zh: "第二學期" },
                t3: { en: "Third Term", zh: "第三學期" }
            };
            
            // Security: Escape all user-facing text
            const gradeText = escapeHtml(gradeNames[currentGrade][currentLang]);
            const subjectText = escapeHtml(subjectNames[currentSubject][currentLang]);
            const termText = escapeHtml(termNames[currentTerm][currentLang]);
            const yearText = escapeHtml(currentYear);
            
            // Security: Use textContent instead of innerHTML
            document.getElementById('paper-list-header').textContent = 
                `${gradeText} / ${subjectText} / ${termText} / ${yearText}`;
        }

        // Load papers (safe version)
        function loadPapers() {
            const paperListBody = document.getElementById('paper-list-body');
            
            // Security: Use DOM methods instead of innerHTML
            paperListBody.textContent = '';
            
            const noPapersDiv = document.createElement('div');
            noPapersDiv.className = 'no-papers';
            
            const icon = document.createElement('i');
            icon.className = 'bi bi-file-earmark-text';
            
            const message = document.createElement('p');
            const messageText = currentLang === 'zh' ? 
                '暫無符合條件的試卷。成為第一個上傳者吧！' : 
                'No papers found for these criteria. Be the first to upload!';
            message.textContent = messageText;
            
            noPapersDiv.appendChild(icon);
            noPapersDiv.appendChild(message);
            paperListBody.appendChild(noPapersDiv);
        }

        // Reset all selections
        function resetBrowser() {
            currentGrade = currentSubject = currentTerm = currentYear = null;
            
            // Reset dropdowns
            document.getElementById('gradeDropdown').selectedIndex = 0;
            document.getElementById('subjectDropdown').selectedIndex = 0;
            document.getElementById('subjectDropdown').disabled = true;
            document.getElementById('termDropdown').selectedIndex = 0;
            document.getElementById('termDropdown').disabled = true;
            document.getElementById('yearDropdown').selectedIndex = 0;
            document.getElementById('yearDropdown').disabled = true;
            
            // Hide paper list
            document.getElementById('paper-list').style.display = 'none';
            
            // Update steps
            updateStepIndicators();
            
            // Scroll to top of section
            document.querySelector('.dropdowns-container').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial language
            changeLang('en');
            
            // Initialize step indicators
            updateStepIndicators();
            
            // Add smooth scrolling for anchor links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    if (targetId === '#') return;
                    
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
            
            // Security: Log security initialization
            console.log('Security features initialized: XSS protection, input validation, CSP enabled');
        });
    </script>
</body>
</html>