

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1,user-scalable=yes">
<link id="page_favicon" href="/images/favicon.ico" rel="icon" type="image/x-icon" />
<title>eClass IP</title>
<link rel="stylesheet" href="https://unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css" integrity="sha384-wXznGJNEXNG1NFsbm0ugrLFMQPWswR3lds2VeinahP8N0zJw9VWSopbjv2x7WCvX" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.5.0.min.js"></script>
<script src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js" integrity="sha384-fA23ZRQ3G/J53mElWqVJEGJzU0sTs+SvzG8fXVWP+kJQ1lwFAOkcUOysnlKJC33U" crossorigin="anonymous"></script>
<script src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js" integrity="sha384-CauSuKpEqAFajSpkdjv3z9t8E7RlpJ1UP0lKM/+NdtSarroVKu069AlsRPKkFBz9" crossorigin="anonymous"></script>
<link href="/templates/2020a/css/login.css?301" rel="stylesheet" type="text/css">
<script language=JavaScript src=/lang/script.b5.js></script>
<script language=JavaScript1.2 src=/templates/script.js></script>
<script language="javascript">
var check_otp = false;
var sending_data = false;
function signInWithADFS(){
	location.href = "./login.adfssso.php";
}
function signInWithGoogle(){
		location.href = "./login.googlesso.php";
	}

function checkLoginForm(){
    if(sending_data) {
        return;
    }

    var login_btn = document.getElementById('login_btn');

    if(check_otp) {
        if(!check_text(document.getElementById('OTPPassword'), "Please enter the OTP.")) {
            return false;
        }

        sending_data = true;
        login_btn.disabled = true;
        $("#loading").show();
        $.post(
            '../login.php',
            $('#form1').serialize(),
            function(data){
                var data_array = data.split(',');
                if(data_array[0] == 'otp_login') {
                    $("#loading").hide();
                    $("input[name=securetoken]").val(data_array[1]);
                    login_btn.disabled = false;
                    alert('無效的 OTP (一次性密碼)，請重新嘗試');
                } else {
                    window.location = data_array[1];
                }
                sending_data = false;
            }
        );

        return false;
    }

	login_btn.disabled = true;
	var obj = document.form1;
	var pass=1;

	if(!check_text(document.getElementById('UserLogin'), "Please enter the user login."))
		pass  = 0;
	else if(!check_text(document.getElementById('UserPassword'), "Please enter the password."))
		pass = 0;

	if(pass)
	{
		document.getElementById('loading').style.display = '';

		        return true;
        	}
	login_btn.disabled = false;
	return false;
}

function OPTPasswordReSend() {
    if(sending_data) {
        return;
    }

    $("#loading").show();
    $("#check_flag").val('3');
    sending_data = true;
    $.post(
        '../login.php',
        $('#form1').serialize(),
        function(data){
            $("#loading").hide();
            var status = data.substr(0,1);
            $("input[name=securetoken]").val(data.substr(2));
            if(status == '1') {
                alert('OTP (一次性密碼) 重發成功。');
            } else {
                alert('請於2分鐘後嘗試重新發送 OTP (一次性密碼)。');
            }
            sending_data = false;
        }
    );
    $("#check_flag").val('2');
}

function checkForgetForm(){
     var obj = document.form2;
     tmp = prompt(ForgotPasswordMsg, "");
     if(tmp!=null && Trim(tmp)!=""){
          obj.UserLogin.value = tmp;
          obj.submit();
     }
}
</script>
</head>

<body><!-- .role-admin / .role-learner / .role-trainer -->
<form id="form1" name="form1" action="../login.php" method="post" onSubmit="return checkLoginForm();">
    
<div id="ploginWrapper">
    <div id="blkPhoto" ></div>

    <div id="blkLogin">

        <div id="blkFormWrapper">

            <div id="blkForm">

                <div id="login_title" class="title_b5">
                    						<span class="title_logo">
            	<img src="/file/PCMS_CMYK.png?1766210199" border="0" >
					  </span>
                                        <span class="title_text">澳門培正中學</span>
                </div>
                    <div class="login_form">
                        <span class="text_login"></span>
                        <span class="text_password"></span>


                        <input class="user_loginname" type="text" name="UserLogin" id="UserLogin" placeholder="登入編號">
                        <input class="user_password" type="password" name="UserPassword" id="UserPassword" placeholder="密碼">

                        <div id="otp_div" style="display: none;">
                            <div class="done_msg done_msg_1" style="width: auto;">已透過推播訊息將 OTP (一次性密碼) 傳送給您，請檢查你的 Teacher App。</div>
                            <div class="done_msg done_msg_2" style="width: auto;">已透過推播訊息將 OTP (一次性密碼) 傳送給您，請檢查你的 Student App。</div>
                            <div class="done_msg done_msg_3" style="width: auto;">已透過推播訊息將 OTP (一次性密碼) 傳送給您，請檢查你的 Parent App。</div>
                            <input class="user_password" type="password" name="OTPPassword" id="OTPPassword" placeholder="一次性密碼">
                        </div>

                        <div id="loading" style="display:none"><img src="/images/2020a/indicator.gif"></div>
                        <input name="submit" type="submit" class="login_btn" id="login_btn" value="登入" />

                                                    <a href="javascript:checkForgetForm();" id="forgot_password" class="forgot_password">重置登入密碼</a>
                        
                        <a href="javascript:OPTPasswordReSend();" id="otp_password_resend" class="forgot_password" style="display: none;">重新發送 OTP</a>

                        <!--20200520-->
                                                                                                                        						
                                            	                                            </div>
            </div>
            <div id="footer">
                <span> <a href="http://www.eclass.com.hk/" target="_blank"><img src="/images/logo_eclass_footer.png" width="59" height="21" border="0" align="absmiddle"></a></span>
            </div>

                                </div>
    </div>
</div>
<input type="hidden" name="home_page" value="1" />
<input type="hidden" name="url" value="/templates/index.php?err=1&DirectLink=">
<input type="hidden" name="AccessLoginPage" value="">
<input type="hidden" name="DirectLink" value="">
<input type="hidden" name="securetoken" value="75ac90285097d5d2372ffe5bcda7c9f0"/><input type="hidden" name="is_opac" value="">
</form>

<form name=form2 action=../forget.php method=post>
    <input type=hidden name=UserLogin>
    <input type=hidden name=url_success value="/templates/index.php?msg=1">
    <input type=hidden name=url_fail value="/templates/index.php?err=2">
    <input type="hidden" name="securetoken" value="4ef3e41390d00a2dad14bae4a9349ec2"/></form>



</body>

<SCRIPT language=javascript>
function openForgetWin () {
win_size = "resizable,scrollbars,status,top=40,left=40,width=650,height=600";
url = null;
if (url != null && url != "")
{
    var forgetWin = window.open (url, 'forget_password', win_size);
    if (navigator.appName=="Netscape" && navigator.appVersion >= "3") forgetWin.focus();
}
}

document.getElementById('UserLogin').focus();

if (top != self){
	top.location = self.location;
}
</script>

</html>
